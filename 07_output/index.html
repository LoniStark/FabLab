<!DOCTYPE html>
<html lang="en">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="../style.css" rel="stylesheet">

<body>

  <header>
  <nav class="navbar navbar-expand-sm"> 
  <div style="align-items: left; justify-content:left;" class="container-fluid">
    <h3 class="nav-title">Explorations in Digital Fabrication</h3>
    <div class="navbar-nav" style="align-items: right;">
      <h4><a class="nav-link" href="https://fablab.atelierstark.com/index.html">Home</a></h4>
      <h4><a class="nav-link" href="https://fablab.atelierstark.com/about.html">About</a></h4>
    </div>
  </div>
</nav>
</header>

<xmp style="display:none;">

<br> 

<h4>Ear Sculpture: Responding with visual and auditory actions</h4>
<br>

With the ultrasonic distance input sensor in place, I wanted to set up output responses from the ear sculpture with visual lighting and sound. 

For the first part of this, since the speaker components (micro SD card adaptor, transister and speaker) were on order, I decided to start with the led lights and a buzzer proxy for the sound component. I decided to keep the proxmity sensor in place so that I could test out different distances and observe output changes. I wanted to get the mechanics working before I thought about the experience of the viewer as they approached the sculpture from different distances.

The output devices, led light strip and buzzer, were hooked up to the arduino board based on the instructions for the two devices. I then set up the if/else logic to trigger different actions based on distance measured by the input device. For this test, I set up small intervals so I didn't need to move out 4 feet everytime I wanted to test a particular action.

A few observations. With the led light strip I had, it was pretty easy to configure for red and green lights. However, the blue light was super faint. While I know that red require the least power, I was surprised at how weak the blue light was. Secondly, the buzzer is super annoying, even at varying tones to play a music track. I will be happy to get the speaker audio set up. 

<iframe class="video" src="https://www.youtube.com/embed/BRFcyrs1mYM" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
<figcaption>Buzzer output hooked up to an oscilloscope.</figcaption>

<iframe class="video" src="https://www.youtube.com/embed/TZ8FEMkzY6s" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
<figcaption>Demo of the output actions based on different distances as recorded by the ultrasonic distance sensor.</figcaption>

Now that I had the output devices hooked up, I took some time to clean up my code and turn the different devices into classes. Here is the code. INSERT CODE

My speaker components came in so I hooked up the components. I did realize I missed getting a micro SD card but thought I could set up the rest of the system. Since this is the first time I am trying to do this, I decided to get this speaker working on its own before incorporating it into my overall circuit. 

As resources, I mainly used these two resources:
<ul>
  <li>https://www.engineersgarage.com/arduino-audio-player/#:~:text=Arduino%20has%20PWM%20gpio's.,we%20can%20hear%20the%20audio </li>
  <li>Video: https://www.youtube.com/watch?v=6DRayPCqK04</li>
<ul>

Per the videos, I have:
<ul>
  <li>Arduino Uno Rev 3 board</li>
  <li> Micro SD TF Card Adapter</li>
  <li>BD 139 transister</li>
  <li>4 Ohm 3W full range audio speaker stereo</li>
</ul>

<img src="01_Output_LEDandBuzzer_Stark_July14.jpg" class="photo" alt="LED and buzzer output set up.">
  <figcaption>Phase one set up with buzzer as proxy for audio speaker. Also need to rethink the LEDs as these will not generate the effect I want to light up the ear sculpture shell.</figcaption>

<img src="02_Output_InitialSpeakerSetup_Stark_July16.jpg" class="photo" alt="Initial speaker set up.">
  <figcaption>Hooked up all the different devices for the speaker set up. I am missing the micro SD card at the moment...</figcaption>


For the code, I also looked at the example. I installed the TMRpcm library (https://github.com/TMRh20/TMRpcm) which was accessible via the Arduino IDE library which made this much easier.

<img src="03_Output_TMRpcmLibraryInstall_Stark_July16.jpg" class="photo" alt="Initial speaker set up.">
  <figcaption>Install of the TMRpcm library in Arduino IDE.</figcaption>

<img src="04_Output_WaveFileConversion_Stark_July16.jpg" class="photo" alt="Initial speaker set up.">
  <figcaption>Also needed to convert the audio file I recorded as a voice memo on my iPhone to 8 bit WAV file. Great resource provided by the video tutorial for this here: https://audio.online-convert.com/convert-to-wav. </figcaption>

Here is the code:

<div class="box">
  <pre>
    <code>
/* Speaker Test Code

Uses the TMRpcm.h library. Reads a wav file from a microSD card reader and outputs to a speaker.

*/

#include "SD.h"
#define SD_ChipSelectPin 4
#include "TMRpcm.h"
#include "SPI.h"

unsigned long previousMillis = 0;
long playTime = 3250; 

TMRpcm audio;

void setup() {
  audio.speakerPin = 9;
  Serial.begin(9600);
  if (!SD.begin(SD_ChipSelectPin)){
    Serial.println("SD fail.");
    return;
  }


}

void loop() {
  unsigned long currentMillis = millis();

 if(currentMillis-previousMillis > playTime)
 {
    audio.setVolume(5);
    audio.play("EarShout.wav");
    Serial.println("Playing ear shout");
    previousMillis = currentMillis; 
 }

}

</code>
</pre>
</div>

Finally, while there were circuit diagrams for hooking up the transister. I found this page to read more about the BD139 transister: https://www.youtube.com/watch?v=vn54E2CsT74

I got a micro SD card, transferred over my "Ear.wav" file and loaded the SD card into the reader to test. It was hard to tell which was the left and right pin of the transister so I had to play around with it until I go it working. I could hear the faint sound of the wave file coming from the speakers. 

<iframe class="video" src="https://www.youtube.com/embed/L_BR0iT8bMo" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
 <figcaption>The sound is so faint that the iPhone's audio recording didn't even pick up the speakers.</figcaption>


Various options were tried to increase the volume including:

<ul>
  <li>Adding an ampliflier instead of the transister. This did not make the sound louder.</li>
  <li>Increasing the power to the amplifier with a 9V power source. This made the volume slightly louder but not by much.</li>
</ul>

I'm going to continue to look for ways to increase the volume, including checking the various components.

After swapping out some of the components, I finally decided to try recording a version of the statement with me shouting into my iPhone. This worked!

<iframe class="video" src="https://www.youtube.com/embed/ONcgT1hW0ZQ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
 <figcaption>Can't believe I got this working. Super cool. Sometimes the solution is the simpliest paft of the puzzle. In this case, I needed to speak way louder into the original recording. I'll work on the sound design later. For now, it technical works! (btw: there is also a lot of rain tonight so some of the noise you are hearing in the video is from the rain outside.</figcaption>


Now that I have the speaker kind of working, I realize that with one input device and potentially three output devices, managing the I/O pins and ensuring adequate power whether plugged in or using a battery becomes a consideration. 

I got it working but the audio track is playing at a very low volume when set at "5". Not sure if it is because I don't have the circuit soldered together or because the power going into the speaker and transister are not correct?


SEEMS SAME CHALLENGE: https://forum.arduino.cc/t/speaker-too-quiet/1056124/7

Components and Power Requirements:

<ul>
<li>Gikfun Speakers: 3W, 4 ohm </li>
<li>Micro SD TF Card Adapter Reader: can interface level is 5V or 3.3V</li>
<li>Ultrasonic Distance 5V power, 0V Ground</li>
<li>BTF-Lighting WS2812B, individually addressable smart RGB LED Pixel: DC5V power supply (https://www.amazon.com/gp/product/B01DC0J3UM/)</li>
</ul>

<br>

In terms of Digital input/output pins:

<ul>
    <li>13: SD Card SCK</li>
    <li> 12: SD Card MISO</li>
    <li>-11: SD Card MOSI</li>
    <li>4: SC Card CS</li>
    <li>-9 : Transister</li>
    <li>-10: Ultrasonic Trig Pin</li>
    <li>8: Ultasponic Echo Pin</li>
    <li>7 : Buzzer Pin</li>
    <li>-6: LED Pin</li>

</ul>


</xmp>

<footer>
      <p>   &copy; Atelier Stark 2023</p>
</footer>


</body>

<script src="https://fablab.atelierstark.com/strapdown.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" ></script>


</html>

